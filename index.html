<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso Exclusivo</title>
    <style>
        /* ESTILOS GENERALES Y MODERNOS */
        :root {
            --primary: #6366f1;
            --bg: #f3f4f6;
            --card: #ffffff;
            --text: #1f2937;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            background: var(--card);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        h1, h2 { margin-bottom: 1.5rem; color: #111827; }
        input {
            width: 100%;
            padding: 12px;
            margin-bottom: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            box-sizing: border-box; /* Importante para padding */
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 0.5rem;
        }
        button:hover { background-color: #4f46e5; }
        button.secondary { background-color: transparent; color: var(--primary); border: 1px solid var(--primary); }
        button.stripe-btn { background-color: #635bff; } /* Color oficial Stripe */
        
        .view { display: none; opacity: 0; transition: opacity 0.3s ease-in-out; }
        .view.active { display: block; opacity: 1; }
        .error { color: #ef4444; font-size: 0.875rem; margin-top: 0.5rem; display: none; }
        .loading { font-size: 0.875rem; color: #6b7280; margin-top: 10px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <script>
        // ==========================================
        // "https://script.google.com/macros/s/AKfycbxCdrthB2s-Sb0rp8Fp9YNtznJWHwTbanvVBw9SHWYU-5RvZCWdTfQKWvnH4LaqeFQ-/exec"
        // ==========================================
        const SCRIPT_URL = "https://script.google.com/macros/s/TU_URL_AQUI/exec";
    </script>

    <div id="view-welcome" class="view active">
        <h1>Bienvenido</h1>
        <p>Accede a contenido exclusivo y herramientas premium.</p>
        <button onclick="nav('view-login')">Iniciar Sesi贸n</button>
        <button class="secondary" onclick="nav('view-register')">Crear Cuenta</button>
    </div>

    <div id="view-register" class="view">
        <h2>Crear Cuenta</h2>
        <input type="email" id="reg-email" placeholder="Tu correo electr贸nico">
        <input type="password" id="reg-pass" placeholder="Crea una contrase帽a">
        <button onclick="handleRegister()">Registrarme y Pagar</button>
        <button class="secondary" onclick="nav('view-welcome')">Volver</button>
        <div id="reg-msg" class="error"></div>
        <div id="reg-load" class="loading">Procesando registro...</div>
    </div>

    <div id="view-payment" class="view">
        <h2>Paso Final: Membres铆a</h2>
        <p>Tu cuenta ha sido creada. Para activarla, realiza el pago seguro.</p>
        
        <a href="https://buy.stripe.com/test_aFa14p69Vgk53hjclXaZi01" target="_blank" style="text-decoration: none;">
            <button class="stripe-btn"> Pagar Membres铆a Ahora</button>
        </a>

        <p style="font-size: 0.8rem; color: #666; margin-top: 20px;">
            Una vez pagado, tu acceso se activar谩.
        </p>
        
        <button class="secondary" onclick="simulatePaymentConfirm()" style="margin-top: 10px; border-style: dashed;">
            (Demo) Simular "Pago Exitoso"
        </button>

        <button class="secondary" onclick="nav('view-login')">Ir al Login</button>
        <div id="pay-load" class="loading">Validando...</div>
    </div>

    <div id="view-login" class="view">
        <h2>Iniciar Sesi贸n</h2>
        <input type="email" id="login-email" placeholder="Correo electr贸nico">
        <input type="password" id="login-pass" placeholder="Contrase帽a">
        <button onclick="handleLogin()">Entrar</button>
        <button class="secondary" onclick="nav('view-welcome')">Volver</button>
        <div id="login-msg" class="error"></div>
        <div id="login-load" class="loading">Verificando credenciales...</div>
    </div>

    <div id="view-dashboard" class="view">
        <h2>Dashboard</h2>
        <p>隆Hola! Tu estatus es <strong style="color: green;">PAID</strong>.</p>
        <div style="text-align: left; background: #f9fafb; padding: 10px; border-radius: 5px;">
            <p>Aqu铆 va tu contenido exclusivo...</p>
            <ul>
                <li>Recurso Premium 1</li>
                <li>Recurso Premium 2</li>
            </ul>
        </div>
        <br>
        <button class="secondary" onclick="location.reload()">Cerrar Sesi贸n</button>
    </div>
</div>

<script>
    // Variables globales para guardar email temporalmente
    let currentUserEmail = "";

    // Navegaci贸n entre vistas
    function nav(viewId) {
        document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
        // Limpiar errores
        document.querySelectorAll('.error').forEach(el => el.style.display = 'none');
    }

    // Funci贸n FETCH gen茅rica (Maneja text/plain para evitar CORS)
    async function postData(action, data) {
        const payload = { action: action, ...data };
        
        try {
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                // IMPORTANTE: text/plain evita el preflight OPTIONS de CORS
                headers: { 'Content-Type': 'text/plain;charset=utf-8' }, 
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            return result;
        } catch (error) {
            console.error("Error:", error);
            return { success: false, message: "Error de conexi贸n." };
        }
    }

    // L贸gica: REGISTRO
    async function handleRegister() {
        const email = document.getElementById('reg-email').value;
        const pass = document.getElementById('reg-pass').value;
        const loader = document.getElementById('reg-load');
        const msg = document.getElementById('reg-msg');

        if(!email || !pass) {
            msg.innerText = "Completa todos los campos";
            msg.style.display = 'block';
            return;
        }

        loader.style.display = 'block';
        msg.style.display = 'none';

        const res = await postData('register', { email, password: pass });
        
        loader.style.display = 'none';
        
        if (res.success) {
            currentUserEmail = email; // Guardar para referencia
            nav('view-payment');
        } else {
            msg.innerText = res.message;
            msg.style.display = 'block';
        }
    }

    // L贸gica: LOGIN
    async function handleLogin() {
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;
        const loader = document.getElementById('login-load');
        const msg = document.getElementById('login-msg');

        loader.style.display = 'block';
        msg.style.display = 'none';

        const res = await postData('login', { email, password: pass });

        loader.style.display = 'none';

        if (res.success) {
            nav('view-dashboard');
        } else {
            msg.innerText = res.message;
            msg.style.display = 'block';
        }
    }

    // L贸gica: SIMULACIN DE PAGO (Bot贸n Demo)
    // En un sistema real, Stripe llamar铆a al backend, no el frontend.
    async function simulatePaymentConfirm() {
        if(!currentUserEmail) {
            alert("Error: No hay email registrado en sesi贸n actual.");
            return;
        }
        const loader = document.getElementById('pay-load');
        loader.style.display = 'block';
        loader.innerText = "Activando cuenta...";

        const res = await postData('payment_confirmation', { email: currentUserEmail });
        
        loader.style.display = 'none';
        
        if(res.success) {
            alert("隆Pago confirmado! Ahora puedes hacer login.");
            nav('view-login');
            // Pre-llenar el email
            document.getElementById('login-email').value = currentUserEmail;
        } else {
            alert("Error al confirmar: " + res.message);
        }
    }
</script>

</body>
</html>
