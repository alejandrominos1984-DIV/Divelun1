<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA | Elite Fitness</title>
    
    <!-- FUENTE INTER -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <!-- TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- LUCIDE ICONS -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- CONFIGURACIÓN DE DISEÑO -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            dark: '#050505',
                            card: '#0f0f0f',
                            accent: '#06b6d4', // Cyan 500
                            glow: 'rgba(6, 182, 212, 0.5)',
                            error: '#ef4444'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.6s ease-out forwards',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* ESTILOS BASE Y UTILIDADES EXTRA */
        body {
            background-color: #050505;
            color: #ffffff;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* Glassmorphism Realista */
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* Bordes brillantes al foco */
        .input-elite:focus {
            border-color: #06b6d4;
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.3);
            outline: none;
        }

        /* Scrollbar oculta */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col items-center justify-center relative selection:bg-cyan-500 selection:text-black">

    <!-- FONDO AMBIENTAL (Glow Effects) -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-cyan-500/10 rounded-full blur-[100px] animate-pulse-slow"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-blue-600/10 rounded-full blur-[100px] animate-pulse-slow" style="animation-delay: 1.5s;"></div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <main id="app" class="w-full max-w-md px-6 py-8 relative z-10 flex flex-col h-screen md:h-auto justify-center">
        
        <!-- ========================================== -->
        <!-- VISTA 1: BIENVENIDA -->
        <!-- ========================================== -->
        <section id="view-welcome" class="view-section flex flex-col items-center justify-center space-y-12 animate-fade-in h-full">
            <div class="text-center space-y-2 animate-slide-up">
                <!-- Logo Simulado -->
                <div class="relative inline-block mb-4">
                    <div class="absolute inset-0 bg-cyan-500 blur-xl opacity-20 rounded-full"></div>
                    <i data-lucide="zap" class="w-16 h-16 text-cyan-400 relative z-10 mx-auto"></i>
                </div>
                <h1 class="text-5xl font-extrabold tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-white to-gray-400 drop-shadow-[0_0_15px_rgba(255,255,255,0.1)]">
                    AURA
                </h1>
                <p class="text-gray-400 text-sm tracking-widest uppercase">Elite Fitness System</p>
            </div>

            <div class="w-full space-y-4 animate-slide-up" style="animation-delay: 0.1s;">
                <button onclick="router.navigate('login')" class="w-full glass py-4 rounded-xl font-semibold text-white transition-all duration-300 hover:bg-white/10 hover:scale-[1.02] flex items-center justify-center gap-2 group">
                    <span>Iniciar Sesión</span>
                    <i data-lucide="arrow-right" class="w-4 h-4 text-gray-400 group-hover:text-white transition-colors"></i>
                </button>
                <button onclick="router.navigate('register')" class="w-full bg-cyan-500 hover:bg-cyan-400 py-4 rounded-xl font-bold text-black transition-all duration-300 shadow-[0_0_20px_rgba(6,182,212,0.3)] hover:shadow-[0_0_30px_rgba(6,182,212,0.5)] hover:scale-[1.02]">
                    Regístrate
                </button>
            </div>
        </section>

        <!-- ========================================== -->
        <!-- VISTA 2: REGISTRO -->
        <!-- ========================================== -->
        <section id="view-register" class="view-section hidden w-full animate-fade-in">
            <div class="mb-8">
                <button onclick="router.navigate('welcome')" class="text-gray-500 hover:text-white transition-colors mb-6">
                    <i data-lucide="arrow-left" class="w-6 h-6"></i>
                </button>
                <h2 class="text-3xl font-bold text-white mb-2">Crear Cuenta</h2>
                <p class="text-gray-400 text-sm">Inicia tu transformación hoy.</p>
            </div>

            <form id="registerForm" onsubmit="app.handleRegister(event)" class="space-y-5">
                <div class="space-y-2">
                    <label class="text-xs text-gray-500 uppercase font-semibold tracking-wider ml-1">Email</label>
                    <div class="relative">
                        <i data-lucide="mail" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"></i>
                        <input type="email" name="email" required placeholder="tu@email.com" 
                            class="w-full bg-brand-card border border-white/10 rounded-xl py-4 pl-12 pr-4 text-white placeholder-gray-600 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 transition-all duration-300 input-elite text-sm">
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-xs text-gray-500 uppercase font-semibold tracking-wider ml-1">Contraseña</label>
                    <div class="relative">
                        <i data-lucide="lock" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"></i>
                        <input type="password" name="password" required placeholder="••••••••" 
                            class="w-full bg-brand-card border border-white/10 rounded-xl py-4 pl-12 pr-4 text-white placeholder-gray-600 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 transition-all duration-300 input-elite text-sm">
                    </div>
                </div>

                <button type="submit" id="btn-register" class="w-full bg-white text-black font-bold py-4 rounded-xl mt-4 hover:bg-gray-200 transition-all duration-300 shadow-lg">
                    Continuar
                </button>
            </form>
        </section>

        <!-- ========================================== -->
        <!-- VISTA 3: LOGIN -->
        <!-- ========================================== -->
        <section id="view-login" class="view-section hidden w-full animate-fade-in">
            <div class="mb-8">
                <button onclick="router.navigate('welcome')" class="text-gray-500 hover:text-white transition-colors mb-6">
                    <i data-lucide="arrow-left" class="w-6 h-6"></i>
                </button>
                <h2 class="text-3xl font-bold text-white mb-2">Bienvenido</h2>
                <p class="text-gray-400 text-sm">Continúa tu legado.</p>
            </div>

            <form id="loginForm" onsubmit="app.handleLogin(event)" class="space-y-5">
                <div class="space-y-2">
                    <label class="text-xs text-gray-500 uppercase font-semibold tracking-wider ml-1">Email</label>
                    <div class="relative">
                        <i data-lucide="user" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"></i>
                        <input type="email" name="email" required placeholder="tu@email.com" 
                            class="w-full bg-brand-card border border-white/10 rounded-xl py-4 pl-12 pr-4 text-white placeholder-gray-600 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 transition-all duration-300 input-elite text-sm">
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-xs text-gray-500 uppercase font-semibold tracking-wider ml-1">Contraseña</label>
                    <div class="relative">
                        <i data-lucide="lock" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"></i>
                        <input type="password" name="password" required placeholder="••••••••" 
                            class="w-full bg-brand-card border border-white/10 rounded-xl py-4 pl-12 pr-4 text-white placeholder-gray-600 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 transition-all duration-300 input-elite text-sm">
                    </div>
                </div>

                <div class="flex justify-end">
                    <a href="#" onclick="app.handleRecovery()" class="text-xs text-cyan-500 hover:text-cyan-400 transition-colors">¿Olvidaste tu contraseña?</a>
                </div>

                <button type="submit" id="btn-login" class="w-full bg-cyan-500 hover:bg-cyan-400 text-black font-bold py-4 rounded-xl mt-4 transition-all duration-300 shadow-[0_0_20px_rgba(6,182,212,0.3)]">
                    Entrar
                </button>
            </form>
        </section>

        <!-- ========================================== -->
        <!-- VISTA 4: MURO DE PAGO (STRIPE) -->
        <!-- ========================================== -->
        <section id="view-paywall" class="view-section hidden w-full animate-fade-in text-center">
            <div class="relative w-full aspect-video rounded-2xl overflow-hidden mb-8 border border-white/10 shadow-2xl group cursor-pointer" onclick="app.openStripe()">
                <div class="absolute inset-0 bg-gradient-to-br from-gray-900 to-black z-0"></div>
                <!-- Tarjeta Decorativa -->
                <div class="absolute inset-0 p-6 flex flex-col justify-between z-10">
                    <div class="flex justify-between items-start">
                        <i data-lucide="crown" class="w-8 h-8 text-yellow-500 drop-shadow-lg"></i>
                        <span class="text-xs font-bold bg-white/10 px-2 py-1 rounded backdrop-blur border border-white/5">PRO</span>
                    </div>
                    <div class="text-left">
                        <p class="text-gray-400 text-xs uppercase tracking-widest mb-1">Membresía</p>
                        <h3 class="text-2xl font-bold text-white tracking-wide">AURA ELITE</h3>
                    </div>
                </div>
                <!-- Efecto Hover -->
                <div class="absolute inset-0 bg-cyan-500/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            </div>

            <h2 class="text-2xl font-bold mb-3">Acceso Exclusivo</h2>
            <p class="text-gray-400 text-sm mb-8 leading-relaxed">
                Desbloquea tu potencial completo. Accede a rutinas personalizadas, seguimiento avanzado y soporte prioritario.
            </p>

            <div class="space-y-4">
                <button onclick="app.openStripe()" class="w-full bg-white text-black font-bold py-4 rounded-xl hover:scale-[1.02] transition-transform duration-300 flex items-center justify-center gap-2">
                    <span>Pagar Membresía</span>
                    <i data-lucide="external-link" class="w-4 h-4"></i>
                </button>
                
                <button onclick="app.confirmPayment()" class="w-full glass py-4 rounded-xl text-sm font-semibold text-gray-300 hover:text-white hover:bg-white/5 transition-all">
                    Ya realicé mi pago
                </button>
            </div>
            
            <p class="mt-6 text-xs text-gray-600">
                Al hacer clic en pagar, se abrirá una nueva pestaña segura.
            </p>
        </section>

        <!-- ========================================== -->
        <!-- VISTA 5: DASHBOARD (HOME) -->
        <!-- ========================================== -->
        <section id="view-dashboard" class="view-section hidden w-full animate-fade-in pb-10">
            <!-- Header -->
            <header class="flex justify-between items-center mb-8 pt-4">
                <div>
                    <h2 class="text-lg font-bold text-white">Hola, <span id="user-name" class="text-cyan-400">Atleta</span></h2>
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Hoy es tu día</p>
                </div>
                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-cyan-500 to-blue-600 p-[1px]">
                    <div class="w-full h-full rounded-full bg-black flex items-center justify-center">
                        <span class="text-xs font-bold text-white">AU</span>
                    </div>
                </div>
            </header>

            <!-- 90 Days Progress (Circular) -->
            <div class="glass rounded-2xl p-6 mb-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-cyan-500/10 blur-[40px] rounded-full"></div>
                
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-semibold text-gray-200 mb-1">Plan 90 Días</h3>
                        <p class="text-xs text-gray-500 mb-4">Fase 1: Hipertrofia</p>
                        <div class="inline-flex items-center gap-2 bg-white/5 px-3 py-1.5 rounded-lg border border-white/5">
                            <i data-lucide="trending-up" class="w-3 h-3 text-green-400"></i>
                            <span class="text-xs font-bold text-green-400">+12% vs ayer</span>
                        </div>
                    </div>
                    
                    <!-- Circular Progress con SVG -->
                    <div class="relative w-24 h-24 flex items-center justify-center">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="6" fill="transparent" class="text-gray-800" />
                            <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="6" fill="transparent" stroke-dasharray="251.2" stroke-dashoffset="180" class="text-cyan-500" stroke-linecap="round" />
                        </svg>
                        <div class="absolute flex flex-col items-center">
                            <span class="text-xl font-bold text-white">28%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weekly Calendar Widget -->
            <div class="mb-8">
                <div class="flex justify-between items-end mb-4">
                    <h3 class="text-sm font-semibold text-white">Esta Semana</h3>
                    <span class="text-xs text-cyan-500">4/7 completados</span>
                </div>
                <div class="flex justify-between items-center bg-brand-card p-4 rounded-xl border border-white/5">
                    <!-- Days Generated by JS -->
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-[10px] text-gray-500">L</span>
                        <div class="w-8 h-8 rounded-full bg-cyan-500/20 text-cyan-400 flex items-center justify-center text-xs font-bold border border-cyan-500/30">✓</div>
                    </div>
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-[10px] text-gray-500">M</span>
                        <div class="w-8 h-8 rounded-full bg-cyan-500/20 text-cyan-400 flex items-center justify-center text-xs font-bold border border-cyan-500/30">✓</div>
                    </div>
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-[10px] text-gray-500">X</span>
                        <div class="w-8 h-8 rounded-full bg-cyan-500/20 text-cyan-400 flex items-center justify-center text-xs font-bold border border-cyan-500/30">✓</div>
                    </div>
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-[10px] text-white font-bold">J</span>
                        <div class="w-8 h-8 rounded-full bg-cyan-500 text-black flex items-center justify-center text-xs font-bold shadow-[0_0_10px_rgba(6,182,212,0.5)]">12</div>
                    </div>
                    <div class="flex flex-col items-center gap-2 opacity-50">
                        <span class="text-[10px] text-gray-500">V</span>
                        <div class="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-xs text-gray-500">13</div>
                    </div>
                    <div class="flex flex-col items-center gap-2 opacity-50">
                        <span class="text-[10px] text-gray-500">S</span>
                        <div class="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-xs text-gray-500">14</div>
                    </div>
                    <div class="flex flex-col items-center gap-2 opacity-50">
                        <span class="text-[10px] text-gray-500">D</span>
                        <div class="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-xs text-gray-500">15</div>
                    </div>
                </div>
            </div>

            <!-- Botón de Acción Principal -->
            <button onclick="app.logWorkout()" class="w-full py-5 rounded-2xl bg-white text-black font-extrabold text-lg shadow-[0_0_30px_rgba(255,255,255,0.15)] hover:bg-gray-200 hover:scale-[1.01] transition-all flex items-center justify-center gap-3">
                <i data-lucide="check-circle-2" class="w-6 h-6"></i>
                Registrar Entrenamiento
            </button>
            
            <button onclick="app.logout()" class="w-full mt-4 py-3 text-xs text-gray-600 hover:text-red-400 transition-colors">
                Cerrar Sesión
            </button>
        </section>

    </main>

    <!-- ========================================== -->
    <!-- LÓGICA DE APLICACIÓN (JAVASCRIPT) -->
    <!-- ========================================== -->
    <script>
        // ##################################################################
        // ###############      SECCIÓN DE CONFIGURACIÓN      ###############
        // ##################################################################

        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwRawqGyc4O8NdCe8sS1g706wFVt7Var-CxChnFs7NltOgi-XgVgxXsUzRHzshZ6QVyxw/exec";
        const STRIPE_LINK = "https://buy.stripe.com/test_aFa14p69Vgk53hjclXaZi01";

        // ##################################################################
        // ###############      FIN DE LA CONFIGURACIÓN       ###############
        // ##################################################################

        /**
         * Sistema de Enrutamiento
         */
        const router = {
            navigate: (viewId) => {
                document.querySelectorAll('.view-section').forEach(el => {
                    el.classList.add('hidden');
                    el.classList.remove('flex');
                });

                const target = document.getElementById(`view-${viewId}`);
                if (target) {
                    target.classList.remove('hidden');
                    if(viewId === 'welcome') target.classList.add('flex');
                    lucide.createIcons();
                    window.scrollTo(0, 0);
                }
            }
        };

        const app = {
            state: {
                user: null,
                isLoading: false
            },

            // Inicialización
            init: () => {
                lucide.createIcons();
                app.checkSession();
            },

            // Verificar Sesión Local
            checkSession: () => {
                const storedUser = localStorage.getItem('aura_user');
                if (storedUser) {
                    try {
                        app.state.user = JSON.parse(storedUser);
                        // Redirección basada en el status guardado localmente
                        if (app.state.user.status === 'PAID') {
                            app.updateDashboardUI();
                            router.navigate('dashboard');
                        } else {
                            router.navigate('paywall');
                        }
                    } catch (e) {
                        console.error("Error al leer sesión local:", e);
                        localStorage.removeItem('aura_user');
                        router.navigate('welcome');
                    }
                } else {
                    router.navigate('welcome');
                }
            },

            // Helper para obtener URL con timestamp (Anti-Caché)
            getApiUrl: () => {
                const sep = SCRIPT_URL.includes('?') ? '&' : '?';
                return `${SCRIPT_URL}${sep}t=${new Date().getTime()}`;
            },

            // Manejo de Registro (Crea nuevos usuarios)
            handleRegister: async (e) => {
                e.preventDefault();
                app.toggleLoading(true, 'btn-register');

                const form = e.target;
                const email = form.email.value.trim().toLowerCase();
                const password = form.password.value;
                
                const userData = {
                    action: 'register',
                    email: email,
                    password: password,
                    date: new Date().toISOString()
                };

                try {
                    // SEGURIDAD: Fetch estándar esperando respuesta JSON
                    // Anti-Caché + Redirect Follow + Text/Plain
                    const response = await fetch(app.getApiUrl(), {
                        method: 'POST',
                        redirect: 'follow',
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify(userData)
                    });

                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }

                    const data = await response.json();

                    if (data.success) {
                        // Usuario creado exitosamente con estado PENDING por defecto
                        const newUser = { 
                            email: email, 
                            status: 'PENDING', 
                            name: email.split('@')[0] 
                        };
                        localStorage.setItem('aura_user', JSON.stringify(newUser));
                        app.state.user = newUser;
                        router.navigate('paywall');
                    } else {
                        // Error lógico del backend (ej: Usuario ya existe)
                        alert(data.message || "Error al registrar. Verifica si el usuario ya existe.");
                    }

                } catch (error) {
                    console.error("Error Registro:", error);
                    alert("Error de conexión. Si usas un bloqueador de anuncios, desactívalo, o verifica tu internet.");
                } finally {
                    app.toggleLoading(false, 'btn-register', 'Continuar');
                }
            },

            // Manejo de Login (Solo valida, no crea)
            handleLogin: async (e) => {
                e.preventDefault();
                app.toggleLoading(true, 'btn-login');

                const form = e.target;
                const email = form.email.value.trim().toLowerCase();
                const password = form.password.value;

                const loginData = {
                    action: 'login',
                    email: email,
                    password: password
                };

                try {
                    // SEGURIDAD: Validación real contra el servidor
                    // Anti-Caché + Redirect Follow + Text/Plain
                    const response = await fetch(app.getApiUrl(), {
                        method: 'POST',
                        redirect: 'follow',
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify(loginData)
                    });

                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }

                    const data = await response.json();

                    if (data.success) {
                        // Login exitoso: Determinar estado de pago real
                        // Priorizamos 'status' si viene del backend, si no, inferimos
                        const status = data.status || (data.hasPaid ? 'PAID' : 'PENDING');
                        
                        const loggedUser = { 
                            email: email, 
                            status: status,
                            name: email.split('@')[0] 
                        };

                        localStorage.setItem('aura_user', JSON.stringify(loggedUser));
                        app.state.user = loggedUser;
                        
                        app.updateDashboardUI();
                        
                        // REDIRECCIÓN LÓGICA DE NEGOCIO
                        if(status === 'PAID') {
                            router.navigate('dashboard');
                        } else {
                            // Si es PENDING o cualquier otro estado, al muro de pago
                            router.navigate('paywall');
                        }
                    } else {
                        // Fallo de autenticación
                        alert("Email o contraseña incorrectos.");
                    }

                } catch (error) {
                    console.error("Error Login:", error);
                    alert("Error de conexión con el servidor. Verifica tu internet o desactiva bloqueadores.");
                } finally {
                    app.toggleLoading(false, 'btn-login', 'Entrar');
                }
            },

            // Abrir Stripe
            openStripe: () => {
                window.open(STRIPE_LINK, '_blank');
            },

            // Confirmar Pago
            confirmPayment: () => {
                if(!app.state.user) return;
                
                // Actualizar estado local optimistamente
                app.state.user.status = 'PAID';
                localStorage.setItem('aura_user', JSON.stringify(app.state.user));
                
                // Notificar al servidor para actualizar la base de datos
                fetch(app.getApiUrl(), {
                    method: 'POST',
                    redirect: 'follow',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({
                        action: 'payment_confirmation',
                        email: app.state.user.email
                    })
                }).then(response => {
                    if(!response.ok) console.warn("Advertencia: No se pudo confirmar el pago en el servidor.");
                }).catch(console.error);

                app.updateDashboardUI();
                router.navigate('dashboard');
            },

            // Recuperar Contraseña
            handleRecovery: () => {
                const email = prompt("Ingresa tu email para recuperar la contraseña:");
                if(email) {
                    fetch(app.getApiUrl(), {
                        method: 'POST',
                        redirect: 'follow',
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify({ action: 'reset_password', email: email })
                    }).catch(console.error);
                    alert("Si el correo existe, recibirás instrucciones.");
                }
            },

            // Log de Entrenamiento
            logWorkout: () => {
                if(!confirm("¿Registrar entrenamiento de hoy?")) return;

                fetch(app.getApiUrl(), {
                    method: 'POST',
                    redirect: 'follow',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({
                        action: 'log_workout',
                        email: app.state.user.email,
                        date: new Date().toISOString()
                    })
                }).then(res => {
                    if(res.ok) alert("¡Entrenamiento registrado! Buen trabajo.");
                    else alert("Hubo un problema al guardar el entrenamiento.");
                }).catch(error => {
                    console.error(error);
                    alert("Error de conexión al guardar.");
                });
            },

            // Cerrar Sesión
            logout: () => {
                localStorage.removeItem('aura_user');
                app.state.user = null;
                router.navigate('welcome');
            },

            // Utilidades UI
            toggleLoading: (isLoading, btnId, originalText = '') => {
                const btn = document.getElementById(btnId);
                if(isLoading) {
                    btn.dataset.original = btn.innerText;
                    btn.disabled = true;
                    btn.innerText = "Procesando...";
                    btn.classList.add('opacity-70', 'cursor-not-allowed');
                } else {
                    btn.disabled = false;
                    btn.innerText = originalText || btn.dataset.original;
                    btn.classList.remove('opacity-70', 'cursor-not-allowed');
                }
            },

            updateDashboardUI: () => {
                const nameEl = document.getElementById('user-name');
                if(app.state.user && app.state.user.name) {
                    nameEl.innerText = app.state.user.name.charAt(0).toUpperCase() + app.state.user.name.slice(1);
                }
            }
        };

        window.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>
